# เครื่องมือบีบอัดวิดีโอ - รองรับการเลือกโหมดคุณภาพเสียง/ภาพ

[English](README.md) | [日本語](README_ja.md) | [中文](README_zh.md) | [한국어](README_ko.md)

เครื่องมือบีบอัดวิดีโอแบบ CLI สำหรับ macOS สามารถระบุขนาดไฟล์เป้าหมายและเลือกโหมดคุณภาพ (เน้นเสียง/เน้นภาพ/สมดุล) เพื่อบีบอัดวิดีโอได้

## คุณสมบัติ

- **ควบคุมขนาดได้อย่างแม่นยำ**: สามารถระบุขนาดเป้าหมายเป็น MB (รองรับทศนิยม)
- **เลือกโหมดคุณภาพ**: เลือกระหว่างเน้นเสียง, เน้นภาพ หรือสมดุล
  - เน้นเสียง (192kbps): เหมาะสำหรับเพลง, การบรรยาย, ASMR
  - เน้นภาพ (128kbps): เหมาะสำหรับอนิเมะ, ภาพยนตร์, การเล่นเกม
  - สมดุล (160kbps): เหมาะสำหรับวิดีโอทั่วไป
- **แสดงความคืบหน้าแบบเรียลไทม์**: แสดงแถบความคืบหน้าและเวลาที่เหลือ
- **การเข้ารหัส 2 พาส**: บรรลุการบีบอัดคุณภาพสูง
- **รองรับการประมวลผลแบบกลุ่ม**: ประมวลผลวิดีโอทั้งหมดในไดเรกทอรีพร้อมกัน
- **โหมด Dry Run**: แสดงตัวอย่างผลลัพธ์ก่อนการบีบอัดจริง
- **บันทึกประวัติการประมวลผล**: บันทึกอัตโนมัติไปที่ `~/.video-compressor/history.log`
- **รองรับการแปลงรูปแบบ**: MP4, MOV, AVI, MKV, WebM, FLV
- **การจัดการข้อผิดพลาดที่ชัดเจน**: แสดงข้อความข้อผิดพลาดที่เข้าใจง่าย

## ความต้องการ

- macOS
- Python 3.8 ขึ้นไป
- ffmpeg

## การติดตั้ง

### 1. ติดตั้ง ffmpeg

```bash
brew install ffmpeg
```

### 2. ดาวน์โหลดสคริปต์

```bash
# โคลนจาก GitHub
git clone https://github.com/hiroki-abe-58/video-compressor.git
cd video-compressor

# หรือดาวน์โหลดโดยตรง
curl -O https://raw.githubusercontent.com/hiroki-abe-58/video-compressor/main/compress_video.py
chmod +x compress_video.py
```

### 3. ให้สิทธิ์การเรียกใช้งาน

```bash
chmod +x compress_video.py
```

## วิธีใช้งาน

### การใช้งานพื้นฐาน

```bash
python3 compress_video.py
```

หรือ:

```bash
./compress_video.py
```

### ตัวเลือกบรรทัดคำสั่ง

```bash
# โหมดปกติ
./compress_video.py

# โหมด Dry Run (แสดงตัวอย่างโดยไม่เข้ารหัส)
./compress_video.py --dry-run

# แสดงเวอร์ชัน
./compress_video.py --version

# แสดงความช่วยเหลือ
./compress_video.py --help
```

### ขั้นตอนการทำงาน

#### ขั้นตอนที่ 1: ป้อนพาธของวิดีโอ
```
ป้อนพาธของไฟล์วิดีโอหรือไดเรกทอรีและกด Enter:
> /path/to/video.mp4
```

**เคล็ดลับ**: สามารถลากและวางจาก Finder ได้

#### ขั้นตอนที่ 2: ป้อนขนาดเป้าหมาย
```
ชื่อไฟล์: video.mp4
ขนาดไฟล์ปัจจุบัน: 150.50 MB
ความยาววิดีโอ: 00:05:30

คุณต้องการบีบอัดวิดีโอนี้เป็นกี่ MB? ป้อนตัวเลขและกด Enter (รองรับทศนิยม):
> 50
```

#### ขั้นตอนที่ 2.5: เลือกโหมดคุณภาพ
```
【ขั้นตอนที่ 2.5】เลือกโหมดคุณภาพ
คุณต้องการบีบอัดในโหมดใด?

  1. เน้นเสียง (เสียง 192kbps)
     สำหรับเพลง, การบรรยาย, ASMR ที่เสียงสำคัญ

  2. เน้นภาพ (เสียง 128kbps)
     สำหรับอนิเมะ, ภาพยนตร์, การเล่นเกม ที่ภาพสำคัญ

  3. สมดุล (เสียง 160kbps)
     สำหรับวิดีโอทั่วไป สมดุลระหว่างเสียงและภาพ

เลือกหมายเลข (ค่าเริ่มต้น: 1):
```

#### ขั้นตอนที่ 3: การแปลงรูปแบบ (ตามต้องการ)
```
ต้องการแปลงนามสกุลไฟล์หรือไม่? (y/กด Enter):
> y

รูปแบบที่รองรับ:
  1. MP4 (H.264)
  2. MOV (QuickTime)
  3. AVI
  4. MKV (Matroska)
  5. WebM
  6. FLV (Flash Video)

เลือกหมายเลข: 1
```

#### ขั้นตอนที่ 4: การบีบอัด
```
[1/2] พาสที่ 1: กำลังวิเคราะห์บิตเรต...
พาสที่ 1: [████████████████████░░░░░░░░░░░░░░░░░░░░]  48.5% | เวลาที่เหลือ: 00:02:15

[2/2] พาสที่ 2: กำลังเข้ารหัสขั้นสุดท้าย...
พาสที่ 2: [████████████████████████████████████████] 100.0% | เวลาที่เหลือ: 00:00:00
```

#### ขั้นตอนที่ 5: เสร็จสมบูรณ์
```
การบีบอัดเสร็จสมบูรณ์! ไฟล์วิดีโอที่บีบอัดแล้วถูกบันทึกเรียบร้อยแล้ว
============================================================
โหมดคุณภาพ: เน้นภาพ
ชื่อไฟล์: video--compressed--50.0MB--2025-11-03-15-30-45.mp4
ตำแหน่งที่บันทึก: /path/to/video--compressed--50.0MB--2025-11-03-15-30-45.mp4
ขนาดเป้าหมาย: 50.00 MB
ขนาดจริง: 49.85 MB
ส่วนต่าง: 0.15 MB
อัตราการบีบอัด: 66.9%
เวลาที่ใช้: 00:10:21
============================================================

ประวัติการประมวลผลบันทึกไว้ที่ ~/.video-compressor/history.log

บีบอัดวิดีโออื่นหรือไม่? (y/n):
```

## โหมดคุณภาพ

### เปรียบเทียบสำหรับเป้าหมาย 50MB (วิดีโอ 1080p ความยาว 5 นาที)

| โหมด | บิตเรตวิดีโอ | บิตเรตเสียง | เหมาะสำหรับ |
|------|-------------|------------|-----------|
| เน้นเสียง | 1145 kbps | 192 kbps | วิดีโอเพลง, คอนเสิร์ต, การบรรยาย, ASMR |
| สมดุล | 1241 kbps | 160 kbps | วล็อก, บทเรียน, เนื้อหาทั่วไป |
| เน้นภาพ | 1337 kbps | 128 kbps | อนิเมะ, ภาพยนตร์, การเล่นเกม, วิดีโอแอ็คชั่น |

**โหมดเน้นภาพจัดสรรบิตเรตให้วิดีโอมากกว่าโหมดเน้นเสียงถึง 17%!**

### การใช้แต่ละโหมด

**เน้นเสียง**
- การแสดงสดและคอนเสิร์ตดนตรี
- การบรรยายและการนำเสนอ
- เนื้อหา ASMR
- พอดแคสต์ที่มีวิดีโอ
- เนื้อหาใดๆ ที่คุณภาพเสียงสำคัญ

**เน้นภาพ**
- งานแอนิเมชั่น
- ภาพยนตร์และละคร
- วิดีโอการเล่นเกมและวอล์กทรู
- วิดีโอแอ็คชั่นที่มีการเคลื่อนไหวซับซ้อน
- การสาธิตเอฟเฟกต์ภาพ

**สมดุล**
- วล็อกและวิดีโอส่วนตัว
- บทเรียนและวิธีทำ
- การสัมภาษณ์
- วิดีโอทั่วไป
- เมื่อเสียงและภาพมีความสำคัญเท่ากัน

## โหมด Dry Run

แสดงตัวอย่างผลลัพธ์โดยไม่เข้ารหัสจริง:

```bash
./compress_video.py --dry-run
```

**ตัวอย่างผลลัพธ์**:
```
ผลลัพธ์ Dry Run
============================================================
ไฟล์อินพุต: video.mp4
ขนาดปัจจุบัน: 150.50 MB
ขนาดเป้าหมาย: 50.00 MB
อัตราการบีบอัด: 66.8%
ความยาววิดีโอ: 00:05:30

【โหมดคุณภาพ】
  เน้นภาพ: จัดลำดับความสำคัญให้ภาพและลดเสียงให้เหลือน้อยที่สุด

【การตั้งค่าการเข้ารหัส】
  บิตเรตวิดีโอ: 1337 kbps
  บิตเรตเสียง: 128 kbps (AAC)
  โคเดก: H.264 (libx264)

【คุณภาพที่คาดการณ์】
  คุณภาพสูง (การลดลงเล็กน้อย)

【ไฟล์เอาต์พุต】
  ชื่อไฟล์: video--compressed--50.0MB--2025-11-03-15-30-45.mp4
  ตำแหน่งที่บันทึก: /path/to/video--compressed--50.0MB--2025-11-03-15-30-45.mp4
============================================================

หากต้องการบีบอัดจริง ให้เรียกใช้โดยไม่มีตัวเลือก --dry-run
```

## การประมวลผลแบบกลุ่ม

ประมวลผลไฟล์วิดีโอทั้งหมดในไดเรกทอรี:

```bash
./compress_video.py

# ป้อนพาธของไดเรกทอรี
> /Users/username/Videos/batch-compress/

# พบไฟล์วิดีโอ 5 ไฟล์:
#   1. video1.mp4 (150.50 MB)
#   2. video2.mov (200.30 MB)
#   ...

# เลือกวิธีการตั้งค่า:
#   1. การตั้งค่าแบบกลุ่ม (ใช้การตั้งค่าเดียวกันกับทุกไฟล์)
#   2. การตั้งค่าแต่ละไฟล์ (กำหนดค่าแต่ละไฟล์แยกกัน)
```

## ประวัติการประมวลผล

การดำเนินการทั้งหมดจะถูกบันทึกอัตโนมัติไปที่ `~/.video-compressor/history.log`

### วิธีดูล็อก

```bash
# แสดงล็อกทั้งหมด
cat ~/.video-compressor/history.log

# แสดงเฉพาะล็อกล่าสุด
tail -n 20 ~/.video-compressor/history.log

# ติดตามล็อกแบบเรียลไทม์
tail -f ~/.video-compressor/history.log

# ค้นหาข้อผิดพลาด
grep ERROR ~/.video-compressor/history.log
```

### รูปแบบล็อก

```
YYYY-MM-DD HH:MM:SS - LEVEL - ข้อความ

ตัวอย่าง:
2025-11-03 15:30:45 - INFO - เครื่องมือบีบอัดวิดีโอ v1.4.0 เริ่มทำงาน
2025-11-03 15:30:50 - INFO - เลือกโหมดคุณภาพ: เน้นภาพ
2025-11-03 15:31:02 - INFO - เริ่มการบีบอัด: video.mp4, โหมด: เน้นภาพ, ขนาดปัจจุบัน: 150.50MB, ขนาดเป้าหมาย: 50.00MB, บิตเรตวิดีโอ: 1337kbps, บิตเรตเสียง: 128kbps
2025-11-03 15:41:23 - INFO - การบีบอัดเสร็จสมบูรณ์: video.mp4 -> video--compressed--50.0MB--2025-11-03-15-31-02.mp4, โหมด: เน้นภาพ, ขนาดปัจจุบัน: 150.50MB, ขนาดเป้าหมาย: 50.00MB, ขนาดจริง: 49.85MB, ส่วนต่าง: 0.15MB, อัตราการบีบอัด: 66.9%, เวลาที่ใช้: 00:10:21
```

## รูปแบบชื่อไฟล์เอาต์พุต

```
[ชื่อไฟล์เดิม]--compressed--[ขนาดเป้าหมาย]MB--[yyyy-mm-dd-hh-mm-ss].[นามสกุล]
```

ตัวอย่าง:
```
my_video--compressed--50.0MB--2025-11-03-15-30-45.mp4
```

## การจัดการข้อผิดพลาด

เครื่องมือนี้ตรวจจับและแสดงข้อผิดพลาดต่อไปนี้อย่างชัดเจน:

- ไม่ได้ติดตั้ง ffmpeg
- ไฟล์ไม่มีอยู่
- รูปแบบไฟล์ที่ไม่รองรับ
- ขนาดเป้าหมายมากกว่าขนาดปัจจุบัน
- ขนาดเป้าหมายเล็กเกินไป (เสียงเพียงอย่างเดียวเกินความจุ)
- ค่าอินพุตไม่ถูกต้อง (ไม่ใช่ตัวเลข ฯลฯ)
- ข้อผิดพลาดในการเข้ารหัส

## รายละเอียดทางเทคนิค

### อัลกอริทึมการบีบอัด

1. **รับความยาววิดีโอ** (ใช้ ffprobe)
2. **เลือกโหมดคุณภาพ** (เน้นเสียง/เน้นภาพ/สมดุล)
3. **คำนวณบิตเรตวิดีโอที่จำเป็นจากขนาดเป้าหมาย**
   ```
   บิตเรตวิดีโอ = (ขนาดเป้าหมาย - ขนาดเสียง) / ความยาววิดีโอ * 0.95
   ```
4. **การบีบอัดคุณภาพสูงด้วยการเข้ารหัส 2 พาส**
   - พาสที่ 1: วิเคราะห์การกระจายบิตเรต
   - พาสที่ 2: การเข้ารหัสที่ปรับให้เหมาะสม

### รูปแบบไฟล์ที่รองรับ

**อินพุต**: `.mp4`, `.avi`, `.mov`, `.mkv`, `.flv`, `.wmv`, `.webm`, `.m4v`, `.mpeg`, `.mpg`

**เอาต์พุต**: `.mp4`, `.mov`, `.avi`, `.mkv`, `.webm`, `.flv`

## การแก้ไขปัญหา

### ไม่พบ ffmpeg
```bash
brew install ffmpeg
```

### การบีบอัดใช้เวลานานเกินไป
- การเข้ารหัส 2 พาสใช้เวลา (พาสที่ 1 + พาสที่ 2)
- วิดีโอยาวอาจใช้เวลาหลายสิบนาที
- สามารถติดตามความคืบหน้าผ่านแถบความคืบหน้า

### ขนาดเป้าหมายคลาดเคลื่อน
- ค่าเบี่ยงเบนประมาณ ±5% เป็นเรื่องปกติ
- หากต้องการความแม่นยำมากขึ้น ให้ตั้งขนาดเป้าหมายเล็กลงเล็กน้อย

### การเข้ารหัสล้มเหลว
- ตรวจสอบพื้นที่ดิสก์
- ตรวจสอบว่าไฟล์วิดีโอไม่เสียหาย
- ลองใช้นามสกุลอื่น

## ประวัติเวอร์ชัน

### v1.4.0
- เพิ่มฟีเจอร์เลือกโหมดคุณภาพ (เน้นเสียง/เน้นภาพ/สมดุล)
- เพิ่มข้อมูลโหมดคุณภาพในล็อก

### v1.3.0
- เพิ่มฟีเจอร์บันทึกประวัติการประมวลผล
- รองรับการหมุนเวียนล็อก (10MB, 5 รุ่น)

### v1.2.0
- เพิ่มโหมด Dry Run
- เพิ่มฟีเจอร์ประเมินระดับคุณภาพ

### v1.1.0
- เพิ่มฟีเจอร์การประมวลผลแบบกลุ่ม
- รองรับการป้อนไดเรกทอรี

### v1.0.0
- รุ่นแรก
- ฟีเจอร์การบีบอัดพื้นฐานแบบเน้นเสียง

## ใบอนุญาต

MIT License

## ผู้เขียน

[hiroki-abe-58](https://github.com/hiroki-abe-58)

## กิตติกรรมประกาศ

อ้างอิง: https://note.com/genelab_999/n/n5db5c3a80793
