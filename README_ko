# 비디오 압축 도구 - 음질/화질 모드 선택 버전

[English](README.md) | [日本語](README_ja.md) | [中文](README_zh.md) | [ไทย](README_th.md)

macOS용 비디오 압축 CLI 도구입니다. 목표 파일 크기를 지정하고 품질 모드(음질 우선/화질 우선/균형)를 선택하여 비디오를 압축할 수 있습니다.

## 특징

- **정확한 크기 제어**: MB 단위로 목표 크기 지정 가능(소수점 지원)
- **품질 모드 선택**: 음질 우선, 화질 우선, 균형 중에서 선택
  - 음질 우선(192kbps): 음악, 강연, ASMR용
  - 화질 우선(128kbps): 애니메이션, 영화, 게임 플레이용
  - 균형(160kbps): 일반 비디오용
- **실시간 진행 상황 표시**: 진행률 바와 남은 시간 표시
- **2패스 인코딩**: 고품질 압축 실현
- **일괄 처리 지원**: 디렉토리 내 모든 비디오를 한 번에 처리
- **드라이런 모드**: 실제 압축 전 결과 미리보기
- **처리 기록 로그**: `~/.video-compressor/history.log`에 자동 저장
- **형식 변환 지원**: MP4, MOV, AVI, MKV, WebM, FLV
- **명확한 오류 표시**: 예상 가능한 오류를 명확하게 알림

## 필수 요구사항

- macOS
- Python 3.8 이상
- ffmpeg

## 설치

### 1. ffmpeg 설치

```bash
brew install ffmpeg
```

### 2. 스크립트 다운로드

```bash
# GitHub에서 클론
git clone https://github.com/hiroki-abe-58/video-compressor.git
cd video-compressor

# 또는 직접 다운로드
curl -O https://raw.githubusercontent.com/hiroki-abe-58/video-compressor/main/compress_video.py
chmod +x compress_video.py
```

### 3. 실행 권한 부여

```bash
chmod +x compress_video.py
```

## 사용법

### 기본 사용법

```bash
python3 compress_video.py
```

또는:

```bash
./compress_video.py
```

### 명령줄 옵션

```bash
# 일반 모드
./compress_video.py

# 드라이런 모드(실제 압축 없이 미리보기만)
./compress_video.py --dry-run

# 버전 표시
./compress_video.py --version

# 도움말 표시
./compress_video.py --help
```

### 실행 흐름

#### 1단계: 비디오 경로 입력
```
비디오 파일 또는 디렉토리 경로를 입력하고 Enter를 누르세요:
> /path/to/video.mp4
```

**팁**: Finder에서 드래그 앤 드롭도 가능합니다

#### 2단계: 목표 크기 입력
```
파일명: video.mp4
현재 파일 용량: 150.50 MB
비디오 길이: 00:05:30

이 비디오를 몇 MB로 압축하시겠습니까? 숫자를 입력하고 Enter를 누르세요.(소수점 가능):
> 50
```

#### 2.5단계: 품질 모드 선택
```
【2.5단계】품질 모드 선택
어떤 모드로 압축하시겠습니까?

  1. 음질 우선 (오디오 192kbps)
     음악, 강연, ASMR 등 소리가 중요한 콘텐츠용

  2. 화질 우선 (오디오 128kbps)
     애니메이션, 영화, 게임 플레이 등 영상이 중요한 콘텐츠용

  3. 균형 (오디오 160kbps)
     일반 비디오용. 음질과 화질의 균형잡힌 설정

번호를 선택하세요 (기본값: 1):
```

#### 3단계: 형식 변환(선택사항)
```
확장자를 변환하시겠습니까? (y/Enter만 누르기):
> y

사용 가능한 형식:
  1. MP4 (H.264)
  2. MOV (QuickTime)
  3. AVI
  4. MKV (Matroska)
  5. WebM
  6. FLV (Flash Video)

번호를 선택하세요: 1
```

#### 4단계: 압축 실행
```
[1/2] 1패스: 비트레이트 분석 중...
1패스: [████████████████████░░░░░░░░░░░░░░░░░░░░]  48.5% | 남은 시간: 00:02:15

[2/2] 2패스: 최종 인코딩 중...
2패스: [████████████████████████████████████████] 100.0% | 남은 시간: 00:00:00
```

#### 5단계: 완료
```
압축이 완료되어 압축된 비디오 파일이 저장되었습니다!
============================================================
품질 모드: 화질 우선
파일명: video--compressed--50.0MB--2025-11-03-15-30-45.mp4
저장 위치: /path/to/video--compressed--50.0MB--2025-11-03-15-30-45.mp4
목표 크기: 50.00 MB
실제 크기: 49.85 MB
차이: 0.15 MB
압축률: 66.9%
처리 시간: 00:10:21
============================================================

처리 기록은 ~/.video-compressor/history.log에 저장되어 있습니다.

다른 비디오를 압축하시겠습니까? (y/n):
```

## 품질 모드

### 목표 50MB 비교 (5분 1080p 비디오)

| 모드 | 비디오 비트레이트 | 오디오 비트레이트 | 적합한 용도 |
|------|-----------------|-----------------|-----------|
| 음질 우선 | 1145 kbps | 192 kbps | 뮤직비디오, 콘서트, 강연, ASMR |
| 균형 | 1241 kbps | 160 kbps | 브이로그, 튜토리얼, 일반 콘텐츠 |
| 화질 우선 | 1337 kbps | 128 kbps | 애니메이션, 영화, 게임 플레이, 액션 비디오 |

**화질 우선 모드는 음질 우선 모드에 비해 비디오에 17% 더 많은 비트레이트를 할당합니다!**

### 각 모드의 사용 구분

**음질 우선**
- 음악 라이브 공연 및 콘서트
- 강연 및 프레젠테이션
- ASMR 콘텐츠
- 비디오가 포함된 팟캐스트
- 음질이 중요한 모든 콘텐츠

**화질 우선**
- 애니메이션 작품
- 영화 및 드라마
- 게임 플레이 영상 및 워크스루
- 복잡한 동작이 있는 액션 비디오
- 시각 효과 시연

**균형**
- 브이로그 및 개인 비디오
- 튜토리얼 및 하우투 비디오
- 인터뷰
- 범용 비디오
- 오디오와 비디오가 동등하게 중요한 경우

## 드라이런 모드

실제 압축 없이 결과를 미리볼 수 있습니다:

```bash
./compress_video.py --dry-run
```

**출력 예시**:
```
드라이런 결과
============================================================
입력 파일: video.mp4
현재 크기: 150.50 MB
목표 크기: 50.00 MB
압축률: 66.8%
비디오 길이: 00:05:30

【품질 모드】
  화질 우선: 화질을 우선시하고 오디오를 최소화

【인코딩 설정】
  비디오 비트레이트: 1337 kbps
  오디오 비트레이트: 128 kbps (AAC)
  코덱: H.264 (libx264)

【예상 품질】
  고품질 (경미한 열화)

【출력 파일】
  파일명: video--compressed--50.0MB--2025-11-03-15-30-45.mp4
  저장 위치: /path/to/video--compressed--50.0MB--2025-11-03-15-30-45.mp4
============================================================

실제로 압축하려면 --dry-run 옵션 없이 실행하세요.
```

## 일괄 처리

디렉토리 내 모든 비디오 파일을 한 번에 처리:

```bash
./compress_video.py

# 디렉토리 경로 입력
> /Users/username/Videos/batch-compress/

# 5개의 비디오 파일을 찾았습니다:
#   1. video1.mp4 (150.50 MB)
#   2. video2.mov (200.30 MB)
#   ...

# 설정 방법을 선택하세요:
#   1. 일괄 설정 (모든 파일에 동일한 설정 적용)
#   2. 개별 설정 (파일별로 설정)
```

## 처리 기록

모든 작업은 `~/.video-compressor/history.log`에 자동 기록됩니다

### 로그 확인 방법

```bash
# 모든 로그 표시
cat ~/.video-compressor/history.log

# 최근 로그만 표시
tail -n 20 ~/.video-compressor/history.log

# 실시간으로 로그 모니터링
tail -f ~/.video-compressor/history.log

# 오류만 검색
grep ERROR ~/.video-compressor/history.log
```

### 로그 형식

```
YYYY-MM-DD HH:MM:SS - LEVEL - 메시지

예시:
2025-11-03 15:30:45 - INFO - 비디오 압축 도구 v1.4.0 시작
2025-11-03 15:30:50 - INFO - 품질 모드 선택: 화질 우선
2025-11-03 15:31:02 - INFO - 압축 시작: video.mp4, 모드: 화질 우선, 현재 크기: 150.50MB, 목표 크기: 50.00MB, 비디오 비트레이트: 1337kbps, 오디오 비트레이트: 128kbps
2025-11-03 15:41:23 - INFO - 압축 완료: video.mp4 -> video--compressed--50.0MB--2025-11-03-15-31-02.mp4, 모드: 화질 우선, 현재 크기: 150.50MB, 목표 크기: 50.00MB, 실제 크기: 49.85MB, 차이: 0.15MB, 압축률: 66.9%, 처리 시간: 00:10:21
```

## 출력 파일명 형식

```
[원본파일명]--compressed--[목표크기]MB--[yyyy-mm-dd-hh-mm-ss].[확장자]
```

예시:
```
my_video--compressed--50.0MB--2025-11-03-15-30-45.mp4
```

## 오류 처리

이 도구는 다음 오류를 감지하고 명확하게 표시합니다:

- ffmpeg 미설치
- 파일이 존재하지 않음
- 지원되지 않는 파일 형식
- 목표 크기가 현재 크기보다 큼
- 목표 크기가 너무 작음(오디오만으로 용량 초과)
- 유효하지 않은 입력값(숫자가 아닌 값 등)
- 인코딩 오류

## 기술 세부사항

### 압축 알고리즘

1. **비디오 길이 가져오기** (ffprobe 사용)
2. **품질 모드 선택** (음질 우선/화질 우선/균형)
3. **목표 크기에서 필요한 비디오 비트레이트 역산**
   ```
   비디오 비트레이트 = (목표 크기 - 오디오 크기) / 비디오 길이 * 0.95
   ```
4. **2패스 인코딩으로 고품질 압축**
   - 1패스: 비트레이트 배분 분석
   - 2패스: 최적화된 인코딩

### 지원 파일 형식

**입력**: `.mp4`, `.avi`, `.mov`, `.mkv`, `.flv`, `.wmv`, `.webm`, `.m4v`, `.mpeg`, `.mpg`

**출력**: `.mp4`, `.mov`, `.avi`, `.mkv`, `.webm`, `.flv`

## 문제 해결

### ffmpeg를 찾을 수 없음
```bash
brew install ffmpeg
```

### 압축에 시간이 너무 오래 걸림
- 2패스 인코딩은 시간이 걸립니다(1패스+2패스)
- 긴 비디오는 수십 분이 걸릴 수 있습니다
- 진행률 바로 진행 상황을 확인할 수 있습니다

### 목표 크기와 차이
- ±5% 정도의 오차는 정상입니다
- 더 정확하게 하려면 목표 크기를 약간 작게 설정하세요

### 인코딩 실패
- 디스크 공간 확인
- 비디오 파일이 손상되지 않았는지 확인
- 다른 확장자로 시도

## 버전 기록

### v1.4.0
- 품질 모드 선택 기능 추가(음질 우선/화질 우선/균형)
- 로그에 품질 모드 정보 추가

### v1.3.0
- 처리 기록 로그 기능 추가
- 로그 로테이션 지원(10MB, 5세대)

### v1.2.0
- 드라이런 모드 추가
- 품질 수준 추정 기능 추가

### v1.1.0
- 일괄 처리 기능 추가
- 디렉토리 입력 지원

### v1.0.0
- 초기 릴리스
- 음질 우선 기본 압축 기능

## 라이선스

MIT License

## 저자

[hiroki-abe-58](https://github.com/hiroki-abe-58)

## 감사의 말

참고: https://note.com/genelab_999/n/n5db5c3a80793
